<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Rule Details</title>
	<meta name="author" content="HappyGnome">
	<link rel="stylesheet" href="style.css">
	<script src="jquery-3.3.1.min.js"></script>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	
	<script type="application/javascript" src="GenerateRuleBox.js"></script>
	<script type="application/javascript">
		$(document).ready(function(){	
			var ruleIDstr=/[0-9]+/.exec(location.search);	
			if(ruleIDstr){
				var ruleID=parseInt(ruleIDstr);
				$.ajax({url:"rules.json", type:"GET", dataType:"json"})
				.done(function(rules){
					if (ruleID<0 || ruleID>=rules.rules.length){
						$("#title").text("Rule Not Found!");
						return;
					}
					var rule=rules.rules[ruleID];
					$("#title").text("Rule "+rule.label+ " Details");
					
					//load propositions while we render the rule##############################
					$.ajax({url:"propositions.json", type:"GET", dataType:"json"})
					.done(function(props){
						for (var i=0; i<rule.proplinks.length; i++){		
							var prop=props.propositions[rule.proplinks[i]];			
							if(prop.ineffect=="1") $("#prop_list").append(GenerateRuleBox(props.propositions, rule.proplinks[i],{id_prefix:"prop",rule_lookup_url:"index.html",rule_name_lookup:rules.rules,details:false, show_author:true}));
							else $("#prop_list_repealed").append(GenerateRuleBox(props.propositions,rule.proplinks[i], {id_prefix:"prop",rule_lookup_url:"index.html",rule_name_lookup:rules.rules,details:false, show_author:true}))
						}
					})
					.fail(function(){
						alert("Oops! Retrieval of rules data failed.");
						<!--TODO-->
					});
					
					//Back to the rule!#################################################
					if(rule.ineffect=="1") $("#rules_list").append(GenerateRuleBox(rules.rules,ruleID,{show_notes:true,rule_lookup_url:"index.html",details:false}));
					else $("#rules_list_repealed").append(GenerateRuleBox(rules.rules,ruleID,{show_notes:true,rule_lookup_url:"index.html",details:false}))
				})
				.fail(function(){
					alert("Oops! Retrieval of rules data failed.");
					<!--TODO-->
				});	
			}
		});
	</script>
	<script type="application/javascript">
		var prev_scroll=0;
		$(window).scroll(function(){
			var new_scroll=$('html, body').scrollTop();
			if (new_scroll<window.prev_scroll) $("nav").css("top","0px");
			else $("nav").css("top","-30px");
			window.prev_scroll=new_scroll;
		});
	</script>
</head>
<body>
	
	<nav>
		<div class="navinner">
						<a class="navlink" href="index.html">RULES</a>
			<a class="navlink navlink_s" href="rule_details.html">1</a>
			<a class="navlink" href="propositions.html">2</a>
		</div>
	</nav>
	
	<div class="page_head">
		<h1 id="title">Rule Details</h1><h2 id="title_annot"></h2>
	</div>
	<div class="rules_list" id="rules_list">
	</div>
	<div class="rules_list rules_list_repealed" id="rules_list_repealed">
	</div>
	<h2 class="repealed_heading">Related Propositions (enacted):</h2>
	<div class="rules_list" id="prop_list">
	</div>
	<h2 class="repealed_heading">Related Propositions (not enacted):</h2>
	<div class="rules_list rules_list_repealed" id="prop_list_repealed">
	</div>
</body>
</html>