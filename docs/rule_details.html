<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Rule Details</title>
	<meta name="author" content="HappyGnome">
	<link rel="stylesheet" href="style.css">
	<script src="jquery-3.3.1.min.js"></script>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
	<script type="application/javascript" src="GenerateRuleBox.js"></script>
	<script type="application/javascript">
		$(document).ready(function(){	
			var ruleIDstr=/[0-9]+/.exec(location.search);	
			if(ruleIDstr){
				var ruleID=parseInt(ruleIDstr);
				$.ajax({url:"rules.json", type:"GET", dataType:"json"})
				.done(function(rules){
					if (!(ruleID in rules.items)){
						$("#title").text("Rule Not Found!");
						return;
					}
					var rule=rules.items[ruleID];
					$("#title").text("Rule "+rule.label+ " Details");
					
					//load propositions while we render the rule##############################
					$.ajax({url:"props.json", type:"GET", dataType:"json"})
					.done(function(props){
						for (var i=0; i<rule.linksto["props"].length; i++){		
							var prop=props.items[rule.linksto["props"][i]];			
							if(prop.ineffect=="1") $("#prop_list").append(GenerateRuleBox(props.items, rule.linksto["props"][i],{id_prefix:"prop",rule_lookup_url:"index.html",rule_name_lookup:rules.items,details:false, show_author:true}));
							else $("#prop_list_repealed").append(GenerateRuleBox(props.items,rule.linksto["props"][i], {id_prefix:"prop",rule_lookup_url:"index.html",rule_name_lookup:rules.items,details:false, show_author:true}))
						}
					})
					.fail(function(){
						alert("Oops! Retrieval of rules data failed.");
						<!--TODO-->
					});
					
					//Back to the rule!#################################################
					if(rule.ineffect=="1") $("#rules_list").append(GenerateRuleBox(rules.items,ruleID,{show_notes:true,rule_lookup_url:"index.html",details:false}));
					else $("#rules_list_repealed").append(GenerateRuleBox(rules.items,ruleID,{show_notes:true,rule_lookup_url:"index.html",details:false}))
				})
				.fail(function(){
					alert("Oops! Retrieval of rules data failed.");
					<!--TODO-->
				});	
			}
		});
	</script>
	<script src="navhide.js" type="application/javascript"></script>
	
	<nav>
		<div class="navinner">
			<a class="navlink" href="index.html">Rules</a>
			<a class="navlink" href="days.html">Days</a>
		</div>
	</nav>
	<div class="navspacer"></div>
	<div class="page_head">
		<h1 id="title">Rule Details</h1><h2 id="title_annot"></h2>
	</div>
	<div class="rules_list" id="rules_list">
	</div>
	<div class="rules_list rules_list_repealed" id="rules_list_repealed">
	</div>
	<h2 class="repealed_heading">Related Propositions (enacted):</h2>
	<div class="rules_list" id="prop_list">
	</div>
	<h2 class="repealed_heading">Related Propositions (not enacted):</h2>
	<div class="rules_list rules_list_repealed" id="prop_list_repealed">
	</div>
</body>
</html>